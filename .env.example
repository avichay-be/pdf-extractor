# Bearer Token Authentication (protects all endpoints)
# Provide via Authorization: Bearer <token> header
API_KEY=your_bearer_token_here_min_32_chars
REQUIRE_API_KEY=false

# Example usage:
# curl -H "Authorization: Bearer your_bearer_token_here" http://localhost:8000/extract

# HTTP Client Configuration
HTTP_CLIENT_TIMEOUT=120.0
HTTP_CLIENT_HEALTH_CHECK_TIMEOUT=10.0
HTTP_MAX_KEEPALIVE_CONNECTIONS=10
HTTP_MAX_CONNECTIONS=20

# Performance Monitoring
RESPONSE_TIME_WARNING_THRESHOLD_MS=30000

AZURE_API_KEY=your_azure_mistral_api_key_here
MISTRAL_API_URL=https://abracrm-4614-resource.services.ai.azure.com/providers/mistral/azure/ocr
MISTRAL_MODEL=mistral-document-ai-2505
MAX_PAGES_PER_CHUNK=15

# Azure Document Intelligence Configuration (for table extraction)
AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT=your_document_intelligence_endpoint_here
AZURE_DOCUMENT_INTELLIGENCE_KEY=your_document_intelligence_key_here
AZURE_DOCUMENT_INTELLIGENCE_MODEL=prebuilt-layout
# Azure OpenAI Configuration (for cross-validation)
AZURE_OPENAI_API_KEY=your_azure_openai_api_key_here
AZURE_OPENAI_ENDPOINT=https://abracrm-4614-resource.cognitiveservices.azure.com/
AZURE_OPENAI_DEPLOYMENT=gpt-5-mini
AZURE_OPENAI_API_VERSION=2025-08-07-preview

# Google Gemini Configuration (alternative validator)
# Get your API key from: https://makersuite.google.com/app/apikey
GEMINI_API_KEY=AIzaSyCiL1HNATPuWOYTNtY1h_Oo5HTvAD9i8s4
GEMINI_MODEL=gemini-3-flash-preview
# Anthropic Claude Configuration (REMOVED - no longer supported)
# Claude client has been removed from the codebase
# CLAUDE_API_KEY=your_claude_api_key_here
# CLAUDE_MODEL=claude-3-5-sonnet-20241022

# Cross-Validation Settings
ENABLE_CROSS_VALIDATION=true
VALIDATION_PROVIDER=gemini
# Options: "openai", "gemini" (Claude support removed)
VALIDATION_SAMPLE_RATE=10
VALIDATION_SIMILARITY_THRESHOLD=0.95
VALIDATION_SIMILARITY_METHOD=number_frequency
# Options: "number_frequency" (compare number distributions, best for financial data)
#          "levenshtein" (compare character-level, alphanumeric only)

# Performance Optimization: Skip sample validation on clean pages (default: true)
# When enabled, only validates pages with detected problems (70-80% fewer API calls)
# When disabled, validates both problem pages AND random sample pages (slower, more thorough)
VALIDATION_SKIP_SAMPLE_IF_CLEAN=true

# Enhanced Validation: Problem Detection (14 patterns)
# Comma-separated list of problems to detect, or "all" to enable all
# Available problems:
#   - empty_tables: 5+ consecutive rows with empty cells
#   - low_content_density: Pages with <100 alphanumeric characters
#   - missing_numbers: Tables with 5+ rows but no numbers
#   - inconsistent_columns: Table rows with varying column counts
#   - repeated_characters: Same character repeated 10+ times (OCR artifacts)
#   - garbled_text: 20%+ special characters (OCR failure)
#   - header_only_tables: Tables with headers but no data rows
#   - very_short_pages: Pages with <200 characters
#   - missing_keywords: No financial terms in substantial pages
#   - malformed_structure: Invalid table separator format
#   - duplicate_content: Same paragraph repeated 3+ times
#   - unknown_characters: 5%+ unrecognized characters (□, ?, �)
#   - repetitive_numbers: Same number repeated 3+ times (e.g., "1000 1000 1000")
#   - markdown_images: Markdown image references (e.g., ![img-01.jpeg](img-01.jpeg))
#
# Recommended for Financial Reports (01_Fin_Reports) - DEFAULT WORKFLOW:
VALIDATION_PROBLEMS_ENABLED=empty_tables,low_content_density,missing_numbers,inconsistent_columns,garbled_text,missing_keywords,repetitive_numbers,markdown_images
#
# Alternative configurations:
# For critical accuracy (all problems): VALIDATION_PROBLEMS_ENABLED=all
# For basic validation (4 problems): VALIDATION_PROBLEMS_ENABLED=empty_tables,missing_numbers,low_content_density,garbled_text
# For bank statements (7 problems): VALIDATION_PROBLEMS_ENABLED=empty_tables,missing_numbers,inconsistent_columns,header_only_tables,low_content_density,garbled_text,missing_keywords

# Image-Specific Validation Prompts (optional - overrides defaults)
# When markdown contains images ![...](path), use these custom prompts for validation
# If not set, uses built-in defaults that emphasize visual element description
#
# Example custom prompts:
IMAGE_VALIDATION_SYSTEM_PROMPT="""Extract all business and financial data from this document page. 

EXTRACT:
✅ All monetary values (₪, NIS, USD, etc.)
✅ All percentages (%)
✅ All dates (DD/MM/YYYY format)
✅ All measurements (מ"ר, דונם, sqm)
✅ All numerical tables with headers
✅ Property identifiers (גוש, חלקה, מגרש numbers)
✅ Unit counts (יח"ד, units)
✅ Names of parties (companies, people, authorities)
✅ License/permit numbers
✅ Contract terms and conditions
✅ Building rights data (אחוזי בניה, תכסית, קומות, קווי בנין)
✅ Transaction details (buyer, seller, price, date, area)

IGNORE:
❌ Maps and diagrams
❌ Logos and headers/footers
❌ Decorative images
❌ Landscape/property photos
❌ Architectural drawings
❌ Location maps

OUTPUT FORMAT:
1. Present tables in clean markdown table format
2. List all monetary values with their context
3. List all dates with their purpose
4. Preserve Hebrew text accurately - especially:
   - אינג' (not אינני)
   - יח"ד (not יחיד)
   - ₪ (not עג)
   - מ"ר, מ' for measurements

STRUCTURE OUTPUT AS:
## מספרים וסכומים
## תאריכים
## טבלאות
## זכויות בניה
## פרטי עסקאות
## פרטי חוזה/הסכם"""
# IMAGE_VALIDATION_USER_PROMPT_TEMPLATE="Analyze page {page_number} which contains charts or images. Describe all visual elements and extract visible data values. Use markdown table syntax for structured data."
#
# Default behavior (if not configured):
# - Emphasizes thorough description of visual elements (charts, diagrams, images)
# - Instructs to extract data values from visual elements
# - Maintains all standard markdown formatting requirements

# Finance-Specific Image Validation Prompts (for 01_Fin_Reports workflow)
# These prompts are automatically used when the 01_Fin_Reports workflow detects markdown images
# Uses Gemini's visual PDF understanding to extract complete tables (fixing missing columns)
# IMPORTANT: Does NOT extract data from images - only text and tables
#
# GEMINI_FINANCE_IMAGE_SYSTEM_PROMPT="Custom finance extraction prompt..."
# GEMINI_FINANCE_IMAGE_USER_PROMPT_TEMPLATE="Extract text and tables from page {page_number}..."
#
# Default behavior (if not configured):
# - IGNORES all images completely (charts, diagrams, photos) - does NOT extract from them
# - Extracts ONLY text paragraphs and numerical tables
# - Uses Gemini's visual understanding to see complete table structure (fixes missing first column)
# - Uses ONLY markdown table syntax with | separators (NEVER HTML tags)
# - Includes ALL table columns including row labels (leftmost column)
# - Flattens complex headers (rowspan/colspan) into simple markdown tables

# Extraction settings
# Set to True to include image references in the output (default: False)
INCLUDE_IMAGES=False

# OpenAI Prompts for PDF Extraction (optional - uses defaults from config.py if not set)
# OPENAI_SYSTEM_PROMPT="You are an expert PDF content extractor..."
# OPENAI_USER_PROMPT_TEMPLATE="Extract all text content from this PDF page (originally page {page_number})..."

# Gemini Prompts for PDF Extraction (optional - uses defaults from config.py if not set)
# GEMINI_SYSTEM_PROMPT="You are an expert PDF content extractor..."
# GEMINI_USER_PROMPT_TEMPLATE="Extract all text content from this PDF page (originally page {page_number})..."

# Claude Prompts for PDF Extraction (REMOVED - no longer supported)
# CLAUDE_SYSTEM_PROMPT="You are an expert PDF content extractor..."
# CLAUDE_USER_PROMPT_TEMPLATE="Extract all text content from this PDF page (originally page {page_number})..."
